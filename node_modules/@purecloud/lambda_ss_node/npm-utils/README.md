NPM Utils
==========

A collection of shell scripts useful for setting up a local npm environment, or for use during Jenkins jobs.

Scripts
========

Installing Node
----------------

`source install-node.sh <node-version>`

Uses nvm to install and activate a particular version of node. If no version is provided, installs the latest release. The script needs to be sourced into the shell in which node will be used to work correctly, so it is mostly useful in the context of build jobs and scripts. If you want an easy way to configure the default version of node in use on your development machine, check out: https://github.com/tj/n

Configuring NPM
----------------
`create-npmrc.sh <artifactory-username> <artifactory-password> > ~/.npmrc`

Generates the contents of an `.npmrc` file that will use a composite of our npmjs.com mirror and Interactive's private npm repository as the default source for packages. The configuration also includes the required credentials to publish to our private repository.

Read-only artifactory credentials for use in this command can be found in confluence:
https://confluence.inin.com/display/PureCloud/Maven+Settings+File+For+Bricks

If you need credentials for publishing to our private npm repository, see the section on Jenkins below.

Publishing Artifacts
---------------------
`version-and-publish.sh`

Checks the current directory for a package.json file. If one is found, checks to see if the package name and version have already been published. If they have, the script bumps the patch version and commits the change before publishing.

Usage With Jenkins
===================

The `jenkins-pre-build.sh` script can be used in a jenkins job to set the node version and generate an .npmrc file with credentials that can publish to our private repository.

To use it, add a shell execution build step to your job:
```
# Check out the latest npm-utils
rm -rf ./npm-utils && git clone --depth=1 git@bitbucket.org:inindca/npm-utils.git ./npm-utils

# Set up node with the provided version and generate a .npmrc file for our private npm repo
source ./npm-utils/scripts/jenkins-pre-build.sh <node-version>

# Add any project-specific build steps here.

# If you're publishing an npm module:
./npm-utils/scripts/version-and-publish.sh
```

If you want to publish your project to our private npm repo instead of npmjs.com, make sure your package.json file has the appropriate registry configured:

```
"publishConfig": {
  "registry": "https://purecloud.artifactoryonline.com/purecloud/api/npm/inin-internal-npm-dev/"
},
```

You may also want to include a `files` option in package.json or use `.npmignore` to avoid publishing these build scripts and other non-essential files to the repo.

If you are using the version-and-publish script, you should use the **Git Publisher** post-build step to push the version bump back upstream if the build is successful.